# XCRI Rankings Application - Apache Configuration
# React SPA with API proxy routing

DirectoryIndex index.html

RewriteEngine On

# Route API requests to CGI proxy
RewriteRule ^api/(.*)$ api-proxy.cgi/$1 [QSA,L]

# Allow CGI execution for API proxy
<Files "api-proxy.cgi">
    Options +ExecCGI
    AddHandler cgi-script .cgi
    Require all granted
</Files>

# SPA fallback - serve index.html for all other non-file requests
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^ index.html [L]

# Security Headers
Header set X-Content-Type-Options "nosniff"
Header set X-Frame-Options "SAMEORIGIN"
Header set X-XSS-Protection "1; mode=block"
Header set Referrer-Policy "strict-origin-when-cross-origin"

# Block Access to Sensitive Files
<FilesMatch "\.(py|pyc|pyo|env|log|ini|cnf)$">
    Require all denied
</FilesMatch>

# Compression for static assets
<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css text/javascript application/javascript application/json
</IfModule>

# Cache Control for static assets
<FilesMatch "\.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$">
    Header set Cache-Control "max-age=31536000, public, immutable"
</FilesMatch>

# No cache for HTML (for SPA updates)
<FilesMatch "\.html$">
    Header set Cache-Control "no-cache, no-store, must-revalidate"
    Header set Pragma "no-cache"
    Header set Expires "0"
</FilesMatch>
