# XCRI Rankings Apache Configuration
# React SPA + FastAPI Backend

RewriteEngine On
RewriteBase /iz/xcri/

# API Reverse Proxy - Forward API requests to FastAPI daemon on port 8001
RewriteCond %{REQUEST_URI} ^/iz/xcri/api/
RewriteRule ^api/(.*)$ http://127.0.0.1:8001/$1 [P,L]

# SPA Routing - Serve index.html for all non-file requests (React Router support)
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_URI} !^/iz/xcri/api/
RewriteRule ^ index.html [L]

# Security Headers
Header set X-Content-Type-Options "nosniff"
Header set X-Frame-Options "SAMEORIGIN"
Header set X-XSS-Protection "1; mode=block"
Header set Referrer-Policy "strict-origin-when-cross-origin"

# Block Access to Sensitive Files
<FilesMatch "\.(py|pyc|pyo|env|log|ini|cnf)$">
    Require all denied
</FilesMatch>

# Compression for static assets
<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css text/javascript application/javascript application/json
</IfModule>

# Cache Control for static assets
<FilesMatch "\.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$">
    Header set Cache-Control "max-age=31536000, public, immutable"
</FilesMatch>

# No cache for HTML (for SPA updates)
<FilesMatch "\.html$">
    Header set Cache-Control "no-cache, no-store, must-revalidate"
    Header set Pragma "no-cache"
    Header set Expires "0"
</FilesMatch>
